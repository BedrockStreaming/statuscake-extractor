#!groovy
pipeline {
    agent {
        label "cloud-builder"
    }
    triggers {
       cron('30 14 * * 1')
    }
    options {
       timestamps()
    }
    environment {
       TARGET_PROJECT_NAME = 'service-6play-geo/master'
    }
    stages {
       stage('Build target pipeline') {
          steps {
             build job: TARGET_PROJECT_NAME, parameters: [string(name: 'IS_CRON_TRIGGERED', value: 'true')], wait: true
          }
       }
    }
    post {
       always {
          echo "Fin de la cronJob"
       }
       success {
          slackSend channel: '#deploy-platform',
               color: 'good',
               message: "SUCCESS: Job ${env.JOB_NAME}, has correctly built ${TARGET_PROJECT_NAME}\n More info at: ${env.BUILD_URL}"
       }
       failure {
          echo "FAIL /o\\"
          slackSend channel: '#deploy-platform',
               color: 'danger',
               message: "FAILURE: Job ${env.JOB_NAME}, failed building ${TARGET_PROJECT_NAME}\n More info at: ${env.BUILD_URL}"
       }
    }
}
